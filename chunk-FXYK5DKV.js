import{a as k,c as z,m as E,o as L}from"./chunk-I5BVM4TL.js";import{C as j,H as C,O as R,X as A,Z as v,aa as d,e,f as p,g as b,ga as f,h as S,q as _,r as y,s as $,w}from"./chunk-CSICKPLX.js";var I={production:!0,clientId:"d9716dd3efb4408491738456849796a1",redirectUri:"https://averagesoftwareenjoyer.github.io/tune-tools/auth-callback",scope:"playlist-modify-private playlist-modify-public user-read-private user-read-recently-played user-top-read",authUrl:"https://accounts.spotify.com/authorize",tokenUrl:"https://accounts.spotify.com/api/token"};var P=(()=>{var r;let o=class o{constructor(){p(this,r,f(z))}getAccessToken$(t,s){let m=new k().set("client_id",I.clientId).set("grant_type","authorization_code").set("redirect_uri",I.redirectUri).set("code",s).set("code_verifier",t);return e(this,r).post(I.tokenUrl,m,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}refreshAccessToken$(t){let s=new k().set("client_id",I.clientId).set("grant_type","refresh_token").set("refresh_token",t);return e(this,r).post(I.tokenUrl,s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}};r=new WeakMap,o.\u0275fac=function(s){return new(s||o)},o.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var U={production:!1,clientId:"d9716dd3efb4408491738456849796a1",redirectUri:"http://localhost:4200/auth-callback",scope:"playlist-modify-private playlist-modify-public user-read-private user-read-recently-played user-top-read",authUrl:"https://accounts.spotify.com/authorize",tokenUrl:"https://accounts.spotify.com/api/token"};var B=(()=>{var r,o;let i=class i{constructor(){p(this,r,!1);p(this,o,!1)}get isUserAuthenticated(){return e(this,r)}set isUserAuthenticated(s){b(this,r,s)}get isUserAuthorized(){return e(this,o)}set isUserAuthorized(s){b(this,o,s)}};r=new WeakMap,o=new WeakMap,i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=d({token:i,factory:i.\u0275fac,providedIn:"root"});let c=i;return c})();var F=["verifier","access_token","refresh_token","token_expiry","state"];var H=(()=>{let r=class r{setItem(i,t){localStorage.setItem(`__${i}`,t)}getItem(i){return localStorage.getItem(`__${i}`)}removeItem(i){localStorage.removeItem(`__${i}`)}clearLocalStorageItems(){for(let i of F)this.removeItem(i)}};r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"});let c=r;return c})();var pe=(()=>{var r,o,i,t,s,m,x;let u=class u{constructor(){p(this,m);p(this,r,f(E));p(this,o,f(P));p(this,i,f(B));p(this,t,f(H));p(this,s,f(L))}generateRandomString(n){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return crypto.getRandomValues(new Uint8Array(n)).reduce((h,g)=>h+a[g%a.length],"")}sha256$(n){let l=new TextEncoder().encode(n);return y(crypto.subtle.digest("SHA-256",l))}base64encode(n){return btoa(String.fromCharCode(...new Uint8Array(n))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}redirectToAuthCodeFlow$(){let n,a=this.generateRandomString(128),l=this.generateRandomString(128);return j([this.sha256$(a),this.sha256$(l)]).pipe(w(([h,g])=>[this.base64encode(h),this.base64encode(g)]),v(([,h])=>{e(this,t).setItem("verifier",a),e(this,t).setItem("state",h)}),v(([h,g])=>{let D=new k().set("client_id",U.clientId).set("response_type","code").set("redirect_uri",U.redirectUri).set("scope",U.scope).set("code_challenge_method","S256").set("code_challenge",h).set("state",g);n=`${U.authUrl}?${D.toString()}`}),w(()=>!1),R(()=>window.location.href=n))}handleAuthCallback$(){return e(this,r).queryParams.pipe(A(({code:n,state:a})=>!n||!a||a!==e(this,t).getItem("state")?(e(this,t).clearLocalStorageItems(),y(e(this,s).navigateByUrl(""))):(e(this,t).removeItem("state"),this.getAccessTokenWrapper$(n))))}getAccessTokenWrapper$(n){let a=e(this,t).getItem("verifier");return a?e(this,o).getAccessToken$(a,n).pipe(C(()=>(e(this,i).isUserAuthenticated=!1,e(this,t).clearLocalStorageItems(),y(e(this,s).navigateByUrl("")).pipe(A(()=>_)))),v(({access_token:l,refresh_token:h})=>{S(this,m,x).call(this,l,h),e(this,t).removeItem("verifier")}),A(()=>y(e(this,s).navigateByUrl("/top-tracks")))):(e(this,i).isUserAuthenticated=!1,e(this,t).clearLocalStorageItems(),y(e(this,s).navigateByUrl("")))}handlePotentiallyExpiredAccessToken$(){let n=e(this,t).getItem("access_token"),a=e(this,t).getItem("refresh_token"),l=e(this,t).getItem("token_expiry");return!n||!a||!l?(e(this,i).isUserAuthenticated=!1,e(this,t).clearLocalStorageItems(),y(e(this,s).navigateByUrl(""))):new Date>new Date(parseInt(l))?e(this,o).refreshAccessToken$(a).pipe(v(({access_token:h,refresh_token:g})=>S(this,m,x).call(this,h,g)),w(()=>!1)):$(!1)}};r=new WeakMap,o=new WeakMap,i=new WeakMap,t=new WeakMap,s=new WeakMap,m=new WeakSet,x=function(n,a){e(this,i).isUserAuthenticated=!0,e(this,t).setItem("access_token",n),e(this,t).setItem("refresh_token",a);let l=new Date().getTime()+36e5;e(this,t).setItem("token_expiry",l.toString())},u.\u0275fac=function(a){return new(a||u)},u.\u0275prov=d({token:u,factory:u.\u0275fac,providedIn:"root"});let c=u;return c})();export{H as a,B as b,I as c,pe as d};
//# sourceMappingURL=chunk-FXYK5DKV.js.map
