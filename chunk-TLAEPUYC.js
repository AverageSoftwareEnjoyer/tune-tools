import{a as Ce,b as ye,c as fe,d as ue,e as Pe,f as Me,g as ge,h as Oe,i as Ee,j as Le,k as Te,l as he,m as be,n as Se,o as we,p as xe,q as ve}from"./chunk-6D4TUKBH.js";import"./chunk-RUU2DM3T.js";import"./chunk-WE45LLRE.js";import{K as me,N as _e,O as de,P as pe,Q as se}from"./chunk-QLWPXHZS.js";import"./chunk-DBDUFRPP.js";import{a as le,b as I}from"./chunk-HP6EYKUB.js";import{c as re,q as ce}from"./chunk-3STR5O7T.js";import{$b as u,Db as D,Fb as B,Gb as V,Hb as z,Ib as _,Jb as d,Ka as G,Kb as b,Lb as q,Mb as X,Ob as J,Oc as te,Qc as ne,Rb as Q,Rc as oe,Sc as ie,Tb as S,Tc as ae,X as R,a as M,ac as W,b as x,bb as j,bc as O,d as m,e as s,ea as g,eb as l,f as U,gc as Z,ic as ee,jc as E,ka as C,kc as Y,lc as N,oa as F,ub as y,x as v,ya as K,yb as H,za as $,zb as f,zc as w}from"./chunk-JNSE3WQE.js";var p={Default:"default",Grouped:"grouped"},L={Index:"index",Name:"name",Date:"date",Link:"link"},Re={[L.Index]:"No.",[L.Name]:"Name",[L.Date]:"Date",[L.Link]:"Link"},T={Index:"index",Name:"name",Score:"score",Link:"link"},De={[T.Index]:"No.",[T.Name]:"Name",[T.Score]:"No. of plays",[T.Link]:"Link"},Ye=M(M({},L),T);var Ne=(()=>{var n,t;let o=class o{constructor(){s(this,n,`${le.apiBaseUrl}/me/player/recently-played`);s(this,t,C(re))}getRecentlyPlayedItems$(i){return m(this,t).get(m(this,n),{params:i})}};n=new WeakMap,t=new WeakMap,o.\u0275fac=function(a){return new(a||o)},o.\u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})();var Ie=(()=>{var n;let t=class t{constructor(){s(this,n,C(ve))}convertRecentlyPlayedItemToLimited(c){let{track:i,played_at:a}=structuredClone(c),{name:r,artists:P,external_urls:h}=m(this,n).convertTopTrackToLimited(i);return{name:r,artists:P,external_urls:h,played_at:a}}convertRecentlyPlayedItemToGrouped(c){let{name:i,artists:a,external_urls:r}=structuredClone(c);return{name:i,artists:a,external_urls:r,score:0,normalizedScore:0}}groupRecentlyPlayedItems(c){let i=Array.from(c.reduce((r,P)=>{let h=P.external_urls.spotify,A=r.get(h);return r.set(h,x(M({},A??this.convertRecentlyPlayedItemToGrouped(P)),{score:(A?.score??0)+1}))},new Map)).map(([,r])=>r).sort(({score:r},{score:P})=>P-r),a=i[0]?.score??0;return i.map(r=>x(M({},r),{normalizedScore:fe(r.score,a)}))}};n=new WeakMap,t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var ke=(()=>{var n,t;let o=class o{constructor(){s(this,n,C(Ne));s(this,t,C(Ie));this.recentlyPlayedItemsLimited$=m(this,n).getRecentlyPlayedItems$({before:new Date().getTime(),limit:50}).pipe(I(),v(({items:i})=>i.map(a=>m(this,t).convertRecentlyPlayedItemToLimited(a))),R({bufferSize:1,refCount:!0})),this.recentlyPlayedItemsGrouped$=this.recentlyPlayedItemsLimited$.pipe(I(),v(i=>m(this,t).groupRecentlyPlayedItems(i)),R({bufferSize:1,refCount:!0}))}};n=new WeakMap,t=new WeakMap,o.\u0275fac=function(a){return new(a||o)},o.\u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})();var Ue=e=>({width:e});function Fe(e,n){if(e&1&&(_(0,"th",10),u(1),d()),e&2){let t=S().$implicit;l(),O(" ",t.value," ")}}function Ke(e,n){if(e&1&&(_(0,"td",8),u(1),d()),e&2){let t=n.dataIndex;l(),O(" ",t+1,". ")}}function $e(e,n){e&1&&y(0,Ke,2,1,"td",11)}function Ge(e,n){if(e&1&&(_(0,"td",8),u(1),E(2,"titlecase"),d()),e&2){let t=n.$implicit;l(),O(" ",Y(2,1,t.name)," ")}}function je(e,n){e&1&&y(0,Ge,3,3,"td",11)}function He(e,n){if(e&1&&(_(0,"td",9)(1,"div",13),b(2,"div",14),_(3,"span",15),u(4),d()()()),e&2){let t=n.$implicit;f("matTooltip",t.score),l(2),f("ngStyle",ee(3,Ue,t.normalizedScore+"%")),l(2),W(t.score)}}function Be(e,n){e&1&&y(0,He,5,5,"td",12)}function Ve(e,n){if(e&1&&(_(0,"td",8),u(1),E(2,"date"),d()),e&2){let t=n.$implicit;l(),O(" ",N(2,1,t.played_at,"dd-MM-yyyy HH:mm")," ")}}function ze(e,n){e&1&&y(0,Ve,3,4,"td",11)}function qe(e,n){if(e&1){let t=J();_(0,"td",8)(1,"a",16),Q("click",function(c){return K(t),$(c.stopPropagation())}),_(2,"mat-icon"),u(3,"library_music"),d()()()}if(e&2){let t=n.$implicit;l(),f("href",t.external_urls.spotify,j)}}function Xe(e,n){e&1&&y(0,qe,4,1,"td",11)}function Je(e,n){if(e&1&&(q(0,4),y(1,Fe,2,1,"th",7)(2,$e,1,0,"td",8)(3,je,1,0,"td",8)(4,Be,1,0,"td",9)(5,ze,1,0,"td",8)(6,Xe,1,0,"td",8),X()),e&2){let t=n.$implicit,o=S(2);f("matColumnDef",t.key),l(2),D(t.key===o.RECENTLY_PLAYED_COLUMNS_KEYS_ALL.Index?2:t.key===o.RECENTLY_PLAYED_COLUMNS_KEYS_ALL.Name?3:t.key===o.RECENTLY_PLAYED_COLUMNS_KEYS_ALL.Score?4:t.key===o.RECENTLY_PLAYED_COLUMNS_KEYS_ALL.Date?5:t.key===o.RECENTLY_PLAYED_COLUMNS_KEYS_ALL.Link?6:-1)}}function Qe(e,n){e&1&&b(0,"tr",17)}function We(e,n){e&1&&b(0,"tr",18)}function Ze(e,n){if(e&1&&(_(0,"table",3),V(1,Je,7,2,"ng-container",4,B),E(3,"keyvalue"),y(4,Qe,1,0,"tr",5)(5,We,1,0,"tr",6),d()),e&2){let t=S();f("dataSource",n),l(),z(N(3,3,t.columns(),t.keepOrder)),l(3),f("matHeaderRowDef",t.columnKeys()),l(),f("matRowDefColumns",t.columnKeys())}}var Ae=(()=>{var n;let t=class t{constructor(){s(this,n);this.viewType=G.required(),this.keepOrder=ye,this.RECENTLY_PLAYED_COLUMNS_KEYS_ALL=Ye,this.RECENTLY_PLAYED_ROUTES=p,this.columns=w(()=>this.viewType()===p.Default?Re:De),this.columnKeys=w(()=>Object.keys(this.columns())),this.switchToView=w(()=>this.viewType()===p.Default?p.Grouped:p.Default),U(this,n,C(ke))}get items$(){return this.viewType()===p.Default?m(this,n).recentlyPlayedItemsLimited$:m(this,n).recentlyPlayedItemsGrouped$}};n=new WeakMap,t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=F({type:t,selectors:[["app-recently-played"]],inputs:{viewType:[1,"viewType"]},standalone:!0,features:[Z],decls:8,vars:6,consts:[[1,"table-container"],[1,"actions-container"],["mat-flat-button","",1,"actions__link",3,"routerLink"],["mat-table","","multiTemplateDataRows","",1,"table",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell",""],["mat-cell","",3,"matTooltip"],["mat-header-cell",""],["mat-cell","",4,"matCellDef"],["mat-cell","",3,"matTooltip",4,"matCellDef"],[1,"score__container"],[1,"score__bar",3,"ngStyle"],[1,"score__text"],["mat-icon-button","","target","_blank","rel","noreferrer noopener","aria-label","Listen on Spotify",3,"click","href"],["mat-header-row",""],["mat-row","",1,"item-row"]],template:function(i,a){if(i&1&&(_(0,"div",0)(1,"div",1)(2,"a",2)(3,"mat-icon"),u(4,"view_carousel"),d(),u(5),d()(),y(6,Ze,6,6,"table",3),E(7,"async"),d()),i&2){let r;l(2),f("routerLink","../"+a.switchToView()),H("aria-label","Switch to "+a.switchToView()),l(3),O(" Switch to ",a.switchToView()," view "),l(),D((r=Y(7,4,a.items$))?6:-1,r)}},dependencies:[ne,ie,ae,de,me,_e,se,pe,Se,ue,Me,Le,ge,Pe,Te,Oe,Ee,he,be,xe,we,te,ce,oe],styles:[`.table-container[_ngcontent-%COMP%]{display:block;width:100%;overflow-x:auto}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{padding:0 .5rem .5rem}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]     .mdc-data-table__header-cell{padding:0 .125rem}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]     .mdc-data-table__cell:not(.mat-column-expandedDetail){padding:.125rem}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .details-row[_ngcontent-%COMP%]{height:0}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{overflow:hidden;display:flex}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .item-details--expanded[_ngcontent-%COMP%]{padding:.5rem 0}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .item-info-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .item-info-container__line--bold[_ngcontent-%COMP%]{font-weight:700}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-index[_ngcontent-%COMP%]{width:5%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-image[_ngcontent-%COMP%]{width:10%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-name[_ngcontent-%COMP%]{width:30%}@media (max-width: 959.98px){.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-name[_ngcontent-%COMP%]{width:40%}}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-artists[_ngcontent-%COMP%]{width:30%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-link[_ngcontent-%COMP%]{width:10%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-expand[_ngcontent-%COMP%]{width:5%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-genres[_ngcontent-%COMP%]{width:30%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-genre[_ngcontent-%COMP%]{width:40%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-score[_ngcontent-%COMP%]{width:55%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .mat-column-date[_ngcontent-%COMP%]{width:15%}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .score__container[_ngcontent-%COMP%]{display:flex;gap:.5rem}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .score__bar[_ngcontent-%COMP%]{height:1.5rem;border-radius:0 .25rem .25rem 0;position:relative;overflow:hidden;display:flex;align-items:center}.table-container[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   .item-row[_ngcontent-%COMP%]{border-bottom-width:0}.actions-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:.5rem 0}.actions-container[_ngcontent-%COMP%]   .actions__link[_ngcontent-%COMP%]{min-width:14rem}
/*# sourceMappingURL=recently-played.component-NF3HBOXN.css.map */`],changeDetection:0});let e=t;return e})();var jt=[{path:":viewType",component:Ae,canActivate:[Ce("recently-played",p,"viewType",p.Default)]},{path:"**",redirectTo:p.Default}];export{jt as default};
//# sourceMappingURL=chunk-TLAEPUYC.js.map
